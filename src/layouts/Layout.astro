---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en" data-theme="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="color-scheme" content="dark light" />
        <title>{title}</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ“</text></svg>"
        />

        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
        />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
    </head>
    <body>
        <slot />
        
        <script>
            const root = document.documentElement;
            const btn = document.getElementById("themeToggle");
            const saved = localStorage.getItem("theme");
            if (saved === "dark" || saved === "light")
                root.setAttribute("data-theme", saved);

            btn?.addEventListener("click", () => {
                const cur = root.getAttribute("data-theme") || "dark";
                const next = cur === "dark" ? "light" : "dark";
                root.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
            });

            let userTheme = root.getAttribute("data-theme") || "dark";
            let detailsStates: boolean[] = [];

            window.addEventListener("beforeprint", () => {
                userTheme = root.getAttribute("data-theme") || "dark";
                root.setAttribute("data-theme", "light");

                const allDetails = document.querySelectorAll("details");
                detailsStates = [];
                allDetails.forEach((detail, index) => {
                    detailsStates[index] = detail.open;
                    detail.open = true;
                });
            });

            window.addEventListener("afterprint", () => {
                root.setAttribute("data-theme", userTheme);

                const allDetails = document.querySelectorAll("details");
                allDetails.forEach((detail, index) => {
                    detail.open = detailsStates[index] || false;
                });
            });
        </script>
    </body>
</html>
